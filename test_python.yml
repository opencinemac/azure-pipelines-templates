steps:
  - script: pip install --no-cache-dir -e .[test]
    displayName: 'Install python test dependencies'

  - script: |
      pytest --junitxml=reports/tests_junit.xml
    displayName: 'pytest'

  - task: PythonScript@0
    displayName: 'check coverage'
    inputs:
      scriptSource: filePath
      scriptPath: '$(BUILD_SCRIPTS_DIR)/python_check_coverage.py'
      failOnStderr: true

  - task: PublishCodeCoverageResults@1
    inputs:
      codeCoverageTool: Cobertura
      summaryFileLocation: $(System.DefaultWorkingDirectory)/**/coverage.xml
      reportDirectory: $(System.DefaultWorkingDirectory)/**/coverage
    condition: succeededOrFailed()
    displayName: 'Publish coverage report'
