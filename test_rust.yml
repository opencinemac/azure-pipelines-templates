steps:

  - script: cargo install cargo-tarpaulin
    displayName: Install tarpaulin

  - script: |
      cargo tarpaulin -v | tee ./zdevelop/tests/_reports/results.json
      cat ./zdevelop/tests/_reports/cobertura.xml > ./reports/coverage.xml
    displayName: Test with Code Coverage

  - script: cargo install cargo2junit
    displayName: install cargo2junit

  - script: cat ./zdevelop/tests/_reports/results.json | cargo2junit > ./reports/tests_junit.xml
    displayName: Convert to JUnit Reports

  - task: PythonScript@0
    displayName: Check Coverage
    inputs:
      scriptSource: filePath
      scriptPath: '$(BUILD_SCRIPTS_DIR)/rust_check_coverage.py'
      failOnStderr: true
